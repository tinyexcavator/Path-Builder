<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>3D Roller Prototype</title>
<style>
  body { margin:0; background:#0b0f14; color:#fff; font-family:sans-serif; }
  canvas { display:block; }
  #ui { position:fixed; top:10px; left:50%; transform:translateX(-50%); display:flex; gap:10px; z-index:5; }
  .card { background:#222; padding:8px 14px; border-radius:8px; box-shadow:0 4px 10px rgba(0,0,0,0.4); }
  .btn { padding:4px 8px; border:none; background:#555; color:#fff; cursor:pointer; border-radius:4px; }
  .btn:hover { background:#777; }
  .hint { font-size:12px; opacity:0.7; }
  #diag{position:fixed;inset:0;display:none;align-items:center;justify-content:center;
        padding:20px;text-align:center;background:rgba(10,14,20,.86);backdrop-filter:blur(6px);z-index:10}
  #diag .panel{max-width:860px;border:1px solid #5a2b36;background:#1a0f14;
        border-radius:14px;padding:18px;box-shadow:0 10px 30px #000a}
  #diag h1{margin:0 0 6px 0;font-size:20px}
  #diag p{margin:8px 0;color:#ffdbe6}
  #diag code{background:#0e141e;padding:2px 6px;border-radius:6px;border:1px solid #22354a}
</style>

<!-- Import map must come BEFORE module script -->
<script type="importmap">
{
  "imports": {
    "three": "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js",
    "three/examples/jsm/": "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/"
  }
}
</script>
</head>

<body>
<div id="ui">
  <div class="card">
    <button id="prevBtn" class="btn">Prev</button>
    <span>LEVEL <span id="levelName">1</span> / 5</span>
    <button id="nextBtn" class="btn">Next</button>
    <button id="resetBtn" class="btn">Reset</button>
  </div>
  <div class="card hint">Mouse drag = rotate • Wheel = zoom • Arrows = move • Space = up • Shift = down</div>
</div>

<div id="diag"><div class="panel">
  <h1 id="diagTitle">Diagnostics</h1>
  <p id="diagMsg">…</p>
  <p class="hint" id="diagHint"></p>
</div></div>

<script type="module">
import * as THREE from 'three';
import { OrbitControls } from 'three/examples/jsm/controls/OrbitControls.js';

/* ---------- Diagnostics helper ---------- */
const showDiag = (title,msg,hint='')=>{
  const d=document.getElementById('diag'); d.style.display='flex';
  document.getElementById('diagTitle').textContent=title;
  document.getElementById('diagMsg').innerHTML=msg;
  document.getElementById('diagHint').innerHTML=hint;
  console.error('[Diag]', title, msg, hint);
};

// WebGL check
const gl = document.createElement('canvas').getContext('webgl2')
         || document.createElement('canvas').getContext('webgl');
if(!gl){
  showDiag('WebGL not available',
    'Your browser did not provide a WebGL context.',
    'Try a non-private window, or Chrome/Firefox. Ensure GPU acceleration is enabled.');
  throw new Error('No WebGL');
}

/* ---------- Scene ---------- */
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x0b0f14);

/* Camera */
const camera = new THREE.PerspectiveCamera(60, innerWidth/innerHeight, 0.1, 1000);
camera.position.set(4,4,8);

/* Renderer */
const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth, innerHeight);
document.body.appendChild(renderer.domElement);

/* Controls */
const controls = new OrbitControls(camera, renderer.domElement);
controls.enableDamping = true;
controls.dampingFactor = 0.05;
controls.screenSpacePanning = true;

/* ---------- Example geometry (Level 1 prototype) ---------- */
const floor = new THREE.Mesh(
  new THREE.PlaneGeometry(10,10),
  new THREE.MeshStandardMaterial({color:0x333333, side:THREE.DoubleSide})
);
floor.rotation.x = -Math.PI/2;
scene.add(floor);

const ballGeo = new THREE.SphereGeometry(0.5, 32, 32);
const ballMat = new THREE.MeshStandardMaterial({color:0xff4444, emissive:0x220000});
const ball = new THREE.Mesh(ballGeo, ballMat);
ball.position.set(0,0.5,0);
scene.add(ball);

/* Light */
scene.add(new THREE.HemisphereLight(0xffffff, 0x444444, 0.8));
const dirLight = new THREE.DirectionalLight(0xffffff, 0.8);
dirLight.position.set(5,10,7);
scene.add(dirLight);

/* Ball movement */
let velocity = new THREE.Vector3();
document.addEventListener('keydown', (e)=>{
  const speed = 0.1;
  if(e.code === 'ArrowUp') velocity.z = -speed;
  if(e.code === 'ArrowDown') velocity.z = speed;
  if(e.code === 'ArrowLeft') velocity.x = -speed;
  if(e.code === 'ArrowRight') velocity.x = speed;
  if(e.code === 'Space') velocity.y = speed; // up
  if(e.code === 'ShiftLeft' || e.code === 'ShiftRight') velocity.y = -speed; // down
});
document.addEventListener('keyup', (e)=>{
  if(['ArrowUp','ArrowDown'].includes(e.code)) velocity.z = 0;
  if(['ArrowLeft','ArrowRight'].includes(e.code)) velocity.x = 0;
  if(['Space','ShiftLeft','ShiftRight'].includes(e.code)) velocity.y = 0;
});

/* Animation loop */
function animate(){
  requestAnimationFrame(animate);
  ball.position.add(velocity);
  controls.update();
  renderer.render(scene, camera);
}
animate();

/* Resize handling */
addEventListener('resize', ()=>{
  camera.aspect = innerWidth/innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth, innerHeight);
});
</script>
</body>
</html>

